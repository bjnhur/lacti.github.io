<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="blog">
	<meta name="author" content="lacti">
	<title>네트워크 offload 장애</title>
	<link href="/css/bootstrap.css" rel="stylesheet">
	<link href="/css/markdownpad-github.css" rel="stylesheet">
	<link href="/css/syntax.css" rel="stylesheet">
	<link href="/css/blog-post.css" rel="stylesheet">
</head>
<body>
	<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="/">#</a>
			</div>

			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse navbar-ex1-collapse">
				<ul class="nav navbar-nav">
					<li><a href="/about/">about</a></li>
					<li><a href="http://twitter.com/lacti/">twitter</a></li>
					<li><a href="http://github.com/lacti/">github</a></li>
					<li><a href="/atom.xml">atom</a></li>
				</ul>
			</div>
			<!-- /.navbar-collapse -->
		</div>
		<!-- /.container -->
	</nav>

	<div class="container">
				<div class="row">
			<div class="col-lg-8">
				<h1 class="page-title">네트워크 offload 장애</h1>
				<p><span class="glyphicon glyphicon-time"></span> Posted on 16 Feb 2014</p>
				<hr>
				<div class="content">
				<p>최근 네트워크 장비 이상 현상으로 고생을 한 적이 있다. 패킷량이 특정 이상일 때 주기적으로 throughput이 감소하는 현상을 보였던 것이다. 플랫폼팀 팀장님께서 각고의 노력 끝에 원인을 찾아내셨다.</p>

<ul>
<li>Large Send offload V2</li>
<li>TCP checksum offload</li>
</ul>

<p>이 옵션이 왜 문제를 일으킬 수 있을까? 이에 대해 자세히 알아보자.</p>

<ul>
<li><a href="http://windowsforum.kr/index.php?category=495009&amp;document_srl=4479149&amp;mid=qna">Windows Forum: 랜카드 옵션 Large Send Offload 가 궁금해요</a></li>
<li><a href="http://myknowledge.kr/29">TCP 체크섬 오프로드</a></li>
</ul>

<p>원래 위 옵션은 cpu로 처리해야 하는 일을 nic가 대신 처리해서 전체 성능을 높여준다는 것이다. 그런데 테스트를 진행했던 네트워크에서는 서버 머신의 nic와 switch 간의 저 옵션이 제대로 동작하지 않아서 주기적으로 문제가 발생한 것이다. 서버 머신의 nic에서 해당 옵션을 끄니 더 이상 문제가 발생하지 않았다.</p>

<p>재미있는 것은, 위 옵션을 끌 경우 cpu에서 처리해야할 일이 늘어나니 cpu 사용량이 늘어나야할텐데 오히려 cpu 사용량이 줄어들었다는 점이다. 아마도 비정상 동작에 의해 packet이 drop되거나 해서 그걸 재전송하기 위해 cpu level까지 작업이 전파된 것으로 추측된다. 물론 정말 그런지는 windows logging 수준으로는 알 수 없으니 nic나 switch 로그를 봐야하는데 그렇게까지는 귀찮아서 안 봤다-_-</p>

<p>지난 번에는 nic driver의 버전 문제로 이런 현상이 있었고, 이번에는 nic와 switch의 호환 문제로 이런 문제가 발생하였다. 볼 때마다 SE는 참 힘든 일이구나 싶다. 이론 공부도 많이 필요한데 다양한 장애 상황에 대응할 수 있을만큼 많은 경험을 쌓아야 하니까-_-;</p>

				</div>

				<div class="row">
					<div class="col-md-6">
					
						<a href="/2014/02/14/secret-of-mswsock-dll/" title="mswsock.dll의 비밀">&laquo; mswsock.dll의 비밀</a>
					
					</div>
					<div class="col-md-6" style="text-align: right;">
					
						<a href="/2014/05/27/ndc14-python-mobile-server/" title="파이썬과 친구들 - 체계적이고 빠른 모바일 게임 서버 개발을 위한 최적의 도구">&raquo; 파이썬과 친구들 - 체계적이고 빠른 모바일 게임 서버 개발을 위한 최적의 도구</a>
				
					</div>
				</div>
				<hr>

				<!-- the comments -->
				<div id="disqus_container">
					<div id="disqus_thread"></div>
					<script type="text/javascript">
						var disqus_shortname = 'lacti';
						(function() {
							var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
							dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
							(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
						})();
					</script>
					<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
					<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
				</div>
			</div>

			<div class="col-lg-4 sides">
			
				<div class="well">
					<h4 class="well-title">Related Posts</a></h4>
					<ul>
					
						<li><a href="/2014/02/14/secret-of-mswsock-dll/">mswsock.dll의 비밀</a> <span class="date">14 Feb 2014</span></li>
					
						<li><a href="/2010/05/01/java-network-programming-2-socket/">자바 네트워크 프로그래밍 2 - Socket</a> <span class="date">01 May 2010</span></li>
					
						<li><a href="/2010/05/01/java-network-programming-1-basic/">자바 네트워크 프로그래밍 1 - 기초</a> <span class="date">01 May 2010</span></li>
					
					</ul>
				</div>
			

				<div class="well">
					<h4 class="well-title">Recent Posts <a href="/" class="show-all">(all)</a></h4>
					<ul>
					
						<li><a href="/2014/06/02/128-things-that-it-architect-doesn-t-do/">IT 아키텍트가 하지 말아야 할 128가지</a> <span class="date">02 Jun 2014</span></li>
					
						<li><a href="/2014/05/29/ndc14-tool-development/">팀을 구하는 툴 개발</a> <span class="date">29 May 2014</span></li>
					
						<li><a href="/2014/05/29/ndc14-the-npc-master/">THE NPCM@STER - 라이브 게임에 어울리는 스토리 텔링의 접근법</a> <span class="date">29 May 2014</span></li>
					
						<li><a href="/2014/05/29/ndc14-mobile-data-mining/">모바일 데이터 분석</a> <span class="date">29 May 2014</span></li>
					
						<li><a href="/2014/05/29/ndc14-live-methodology/">신입 프로그래머들의 고민을 통해 생각해보는 누구나 쉽게 적응할 수 있는 프로젝트 만들기</a> <span class="date">29 May 2014</span></li>
					
						<li><a href="/2014/05/29/ndc14-dungeon-and-fighter-loader-optimization/">Ndc14 Dungeon And Fighter Loader Optimization</a> <span class="date">29 May 2014</span></li>
					
					</ul>
				</div>
			</div>
		</div>

		
		<footer>
			<hr>
			<div class="row">
				<div class="col-lg-12">
					<em>&copy; 2008-2014 Jaeyoung Choi</em>
				</div>
			</div>
		</footer>
	</div>
	<!-- /.container -->

	<!-- JavaScript -->
	<script src="/js/jquery-1.10.2.js"></script>
	<script src="/js/bootstrap.js"></script>
</body>
</html>
