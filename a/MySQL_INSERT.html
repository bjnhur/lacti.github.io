<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>MySQL INSERT</title>
    <link href='../res/main.css' rel='stylesheet' type='text/css' />
	<link href="http://yui.yahooapis.com/pure/0.3.0/grids-min.css" rel="stylesheet">
    <link href='http://alexgorbatchev.com/pub/sh/current/styles/shCore.css' rel='stylesheet' type='text/css' />
    <link href='http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css' rel='stylesheet' type='text/css' />
    <script src='http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/current/scripts/shAutoloader.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushXml.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJScript.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushCSharp.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushCpp.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJava.js' type='text/javascript'></script>
  </head>
  <body>
    <div id='title'>
      <h1>MySQL INSERT</h1>
    </div>
    <div id='content'>
요번에 만든 풀씨 채팅방은 MySQL Memory Table과 Prototypejs의 polling 기반이다.<br />
따라서 사용자가 꽤 접속하면 apache가 좀 힘들어할 수는 있지만, 그 양을 정량적으로 계산해봤을 때 크게 무리가 없다고 판단, 과도한 용도가 아닌 경우에서는 써도 괜찮겠다 싶어서 구현해놨다.<br />
<br />
어차피 나중에 부분 update와 websocket으로만 치환해놓으면 되겠지.<br />
<br />
그건 그렇고 MySQL의 INSERT 문과 UPDATE문을 같이 쓰고 싶을 대,<br />
난 항상 UPDATE를 먼저 시도하고 affected된 row의 수를 확인하거나 query의 성공여부를 확인해서 INSERT를 썼는데, 이게 생각보다 잘 안된다.<br />
Memory Table이라서 그런건지 이유는 잘 모르겠는데 저 두 동작을 하나의 질의어로 합치고 싶었으나 내 지식선에서는 아는 바가 없었고,<br />
<br />
http://dev.mysql.com/doc/refman/5.5/en/insert.html<br />
http://dev.mysql.com/doc/refman/5.5/en/insert-on-duplicate.html<br />
<br />
찾아보니까 ON DUPLICATE KEY UPDATE라는 재밌는 문법이 있다.<br />
INSERT 를 실패했는데 그 이유가 DUPLICATE KEY라면 UPDATE를 수행하겠다는 것인데,<br />
지금까지 저렇게 만들었던 모든 문제가 해결되어버렸다-_-;<br />
<br />
역시 사람은 공부를 해야해<br />
조금 알고 있다고 reference를 찾아보지 않는 것은 좋지 않다<br />
그러고보니 SQL은 제대로 공부한 적이 없잖아?<br />

    </div>
    <div id='clear'></div>
  </body>
  <script type='text/javascript'>
    SyntaxHighlighter.all();
  </script>
</html>