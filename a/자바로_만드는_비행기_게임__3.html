<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="blog">
    <meta name="author" content="lacti">

    <title>자바로 만드는 비행기 게임 #3</title>
	<link href="http://yui.yahooapis.com/pure/0.3.0/grids-min.css" rel="stylesheet">
    <link href='http://alexgorbatchev.com/pub/sh/current/styles/shCore.css' rel='stylesheet' type='text/css' />
    <link href='http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css' rel='stylesheet' type='text/css' />
    <script src='http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/current/scripts/shAutoloader.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushXml.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJScript.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushCSharp.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushCpp.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJava.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushBash.js' type='text/javascript'></script>

    <!-- Bootstrap core CSS -->
    <link href="../css/bootstrap.css" rel="stylesheet">

    <!-- Add custom CSS here -->
    <link href="../css/blog-post.css" rel="stylesheet">

</head>

<body>

    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">#</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="#about">About</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <div class="container">

        <div class="row">
            <div class="col-lg-8">

                <!-- the actual blog post: title/author/date/content -->
                <h1>자바로 만드는 비행기 게임 #3</h1>
                <p>
                    <span class="glyphicon glyphicon-time"></span> Posted on November 06, 2011 at 9:16 PM</p>
                <hr>
                <div class="content">
#<br />
이번에는 적기의 등장과 충돌검사를 해보자.<br />
적기는, y=0 에서 등장해서 y=height 까지 진행한다. 즉, 화면 위쪽에서 아래쪽으로 일직선으로 진행하도록 하자.<br />
그러면 진행하는 y 값은 항상 동일할테니까(0 -&gt; height) 시작과 끝 x 값을 random 으로 뽑으면 된다.<br />
<br />
적기의 속도를 다양하게 한다고 한다면 원래 속도를 랜덤하게 구해서 그만큼씩 이동하게 하겠지만,<br />
그렇게 계산해주기 귀찮으니까 등장 시간을 랜덤하게 뽑고(5초에서 10초 사이)<br />
그 시간에 대해 랜덤한 시작좌표 ~ 끝좌표를 토대로 매 tick(100ms) 마다 얼마나 이동하면 될지 delta 를 구한다.<br />
<pre class="brush: java; html-script: true">class EnemyPos {<br />
    Point2D delta, current;<br />
    public EnemyPos(int shipHeight) {<br />
        Random rand = new Random();<br />
        float lifetime = rand.nextFloat() * 50 + 50;<br />
        int startX = rand.nextInt(640);<br />
        int endX = rand.nextInt(640);<br />
        delta = new Point2D.Float((endX - startX) / lifetime, (480 + shipHeight * 2) / lifetime);<br />
        current = new Point2D.Float(startX, -1 * shipHeight);<br />
    }<br />
}</pre><br />
그러면 매 tick 마다 current 는 delta 만큼 더해주면 된다.<br />
시작 y 와 끝 y 는 적기가 완전히 지나갈 수 있도록 비행기 그림의 height 만큼씩 더 고려해주었다.<br />
<br />
적기를 만들어주는 것도 여러 고려할 것이 있겠지만, 귀찮으니까 랜덤한 시간으로 만들어준다.<br />
일단 spawnTick 이라는걸 두어서, 현재 시간이 spawnTick 을 넘어갈 때만 적기를 만들고, 이 때 spawnTick 을 랜덤하게 갱신한다.<br />
<pre class="brush: java; html-script: true">private long spawnTick = 0;<br />
private void generateEnemy() {<br />
    if (spawnTick < System.currentTimeMillis()) {<br />
        spawnTick = System.currentTimeMillis() + new Random().nextInt(2000) + 500;<br />
        enemies.add(new EnemyPos(enemy.getHeight(this)));<br />
    }<br />
}</pre><br />
<br />
이제 매 Tick 마다 적기가 움직일 수 있도록 위치 갱신을 해준다.<br />
적기는 +y 방향으로 진행하며, 대충 화면 크기 height 가 480 이니까 560 정도 지나갈 때 비행기를 없애준다.<br />
<pre class="brush: java; html-script: true">private void updateEnemyPos() {<br />
    Iterator<EnemyPos> iterator = enemies.iterator();<br />
    while (iterator.hasNext()) {<br />
        EnemyPos pos = iterator.next();<br />
        pos.current.setLocation(pos.current.getX() + pos.delta.getX(), <br />
                pos.current.getY() + pos.delta.getY());<br />
        if (pos.current.getY() > 560)<br />
            iterator.remove();<br />
    }<br />
}</pre><br />
미리 매 tick 마다 얼마나 움직일 지 계산해놨으니까, 현재의 위치는 거기서 더해주기만 하면 된다.<br />
<br />
이제 적기도 그려주자. paint 함수에 현재 존재하는 적기들을 그려주도록 하면 된다.<br />
<pre class="brush: java; html-script: true">for (EnemyPos enemyPos: enemies) {<br />
    g.drawImage(enemy, (int) enemyPos.current.getX() - enemy.getWidth(this) / 2,<br />
        (int) enemyPos.current.getY() - enemy.getHeight(this) / 2, this);<br />
}</pre><br />
<br />
이제 랜덤한 시간에, 랜덤한 위치로 적기가 생성되어서 +y 방향으로 진행하는 것을 볼 수 있다.<br />
여기까지 코드는 다음과 같다.<br />
<pre class="brush: java; html-script: true">import java.util.*;<br />
import java.awt.*;<br />
import java.awt.event.*;<br />
import java.awt.geom.*;<br />
import javax.swing.*;<br />
public class Tatieul extends JPanel implements KeyListener, ActionListener {<br />
    private Point shipPos = new Point(320, 400);<br />
    private Image ship, enemy;<br />
    private ArrayList<Point> bullets = new ArrayList<Point>();<br />
    private ArrayList<EnemyPos> enemies = new ArrayList<EnemyPos>();<br />
    private long spawnTick = 0;<br />
    public Tatieul() {<br />
        setPreferredSize(new Dimension(640, 480));<br />
        setFocusable(true);<br />
        addKeyListener(this);<br />
        ship = Toolkit.getDefaultToolkit().getImage("player.png");<br />
        enemy = Toolkit.getDefaultToolkit().getImage("enemy.png");<br />
        new javax.swing.Timer(100, this).start();<br />
    }<br />
    public void keyPressed(KeyEvent e) {<br />
        switch (e.getKeyCode()) {<br />
        case KeyEvent.VK_UP:    shipPos.y -= 10; break;<br />
        case KeyEvent.VK_DOWN:  shipPos.y += 10; break;<br />
        case KeyEvent.VK_LEFT:  shipPos.x -= 10; break;<br />
        case KeyEvent.VK_RIGHT: shipPos.x += 10; break;<br />
        case KeyEvent.VK_SPACE: bullets.add(new Point(shipPos.x, shipPos.y)); break;<br />
        }<br />
        repaint();<br />
    }<br />
    public void actionPerformed(ActionEvent e) {<br />
        updateEnemyPos();<br />
        updateBullets();<br />
        generateEnemy();<br />
        repaint();<br />
    }<br />
    private void generateEnemy() {<br />
        if (spawnTick < System.currentTimeMillis()) {<br />
            spawnTick = System.currentTimeMillis() + new Random().nextInt(2000) + 500;<br />
            enemies.add(new EnemyPos(enemy.getHeight(this)));<br />
        }<br />
    }<br />
    private void updateEnemyPos() {<br />
        Iterator<EnemyPos> iterator = enemies.iterator();<br />
        while (iterator.hasNext()) {<br />
            EnemyPos pos = iterator.next();<br />
            pos.current.setLocation(pos.current.getX() + pos.delta.getX(), <br />
                    pos.current.getY() + pos.delta.getY());<br />
            if (pos.current.getY() > 560)<br />
                iterator.remove();<br />
        }<br />
    }<br />
    private void updateBullets() {<br />
        Iterator<Point> iterator = bullets.iterator();<br />
        while (iterator.hasNext()) {<br />
            Point bullet = iterator.next();<br />
            bullet.y -= 20;<br />
            if (bullet.y < 0)<br />
                iterator.remove();<br />
        }<br />
    }<br />
    public void keyReleased(KeyEvent e) {}<br />
    public void keyTyped(KeyEvent e) {}<br />
    public void paintComponent(Graphics g) {<br />
        g.setColor(Color.white);<br />
        g.fillRect(0, 0, 640, 480);<br />
        g.drawImage(ship, shipPos.x - ship.getWidth(this) / 2, shipPos.y - ship.getHeight(this) / 2, this);<br />
        for (EnemyPos enemyPos: enemies) {<br />
            g.drawImage(enemy, (int) enemyPos.current.getX() - enemy.getWidth(this) / 2,<br />
                (int) enemyPos.current.getY() - enemy.getHeight(this) / 2, this);<br />
        }<br />
        g.setColor(Color.black);<br />
        for (Point bullet: bullets)<br />
            g.drawLine(bullet.x, bullet.y, bullet.x, bullet.y - 4);<br />
    }<br />
    public static void main(String[] args) {<br />
        JFrame frame = new JFrame("Tatieul - New Generation Shooting Game");<br />
        frame.setContentPane(new Tatieul());<br />
        frame.pack();<br />
        frame.setLocationRelativeTo(null);<br />
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);<br />
        frame.setVisible(true);<br />
    }<br />
}<br />
class EnemyPos {<br />
    Point2D delta, current;<br />
    public EnemyPos(int shipHeight) {<br />
        Random rand = new Random();<br />
        float lifetime = rand.nextFloat() * 50 + 50;<br />
        int startX = rand.nextInt(640);<br />
        int endX = rand.nextInt(640);<br />
        delta = new Point2D.Float((endX - startX) / lifetime, (480 + shipHeight * 2) / lifetime);<br />
        current = new Point2D.Float(startX, -1 * shipHeight);<br />
    }<br />
}</pre><br />
<br />
#<br />
적기도 총알을 쏴야한다. 하지만 지금까지 총알은 모두 -y 방향(플레이어가 쐈을 때)만 고려되어서 만들어져있다.<br />
따라서 총알도 방향 정보가 추가되어야 한다.<br />
<pre class="brush: java; html-script: true">class Bullet {<br />
    Point pos;<br />
    int direction;<br />
    public Bullet(int x, int y, int direction) {<br />
        this.pos = new Point(x, y);<br />
        this.direction = direction;<br />
    }<br />
}</pre><br />
<br />
이에 따라 기존에 총알을 관리하던 코드가 바뀌어야 한다.<br />
플레이어는 -y 방향으로 쏘니까 direction 값이 - 가 될테고, 이를 저장하는 List 는 Point 가 아닌 Bullet 을 가져야할테고,<br />
그림 그리는 곳과 총알이 사라지는 곳까지 다 고쳐주면 된다.<br />
<pre class="brush: java; html-script: true">private ArrayList<Bullet> bullets = new ArrayList<Bullet>();<br />
public void keyPressed(KeyEvent e) {<br />
    switch (e.getKeyCode()) {<br />
    case KeyEvent.VK_SPACE: bullets.add(new Bullet(shipPos.x, shipPos.y, -1)); break;<br />
    }<br />
    repaint();<br />
}<br />
<br />
private void updateBullets() {<br />
    Iterator<Bullet> iterator = bullets.iterator();<br />
    while (iterator.hasNext()) {<br />
        Bullet bullet = iterator.next();<br />
        bullet.pos.y += bullet.direction * 20;<br />
        if ((bullet.direction < 0 && bullet.pos.y < 0)<br />
                || (bullet.direction > 0 && bullet.pos.y > 560))<br />
            iterator.remove();<br />
    }<br />
}<br />
<br />
public void paintComponent(Graphics g) {<br />
    g.setColor(Color.black);<br />
    for (Bullet bullet: bullets)<br />
        g.drawLine(bullet.pos.x, bullet.pos.y, bullet.pos.x, bullet.pos.y - 4);<br />
}</pre><br />
<br />
적기도 총알을 쏴야한다.<br />
간단하게 각 적기가 매 tick 마다 random 돌려서 0.3 보다 작은 값이 나오면 총알을 만들도록 하자-_-<br />
<pre class="brush: java; html-script: true">private void generateEnemyBullet() {<br />
    for (EnemyPos enemyPos: enemies) {<br />
        if (Math.random() < 0.2) {<br />
            bullets.add(new Bullet((int) enemyPos.current.getX(), <br />
                    (int) enemyPos.current.getY(), 1));<br />
        }<br />
    }<br />
}</pre><br />
<br />
이제 충돌검사를 구현한다.<br />
본 게임에서는 간단하게 3가지 충돌검사만 구현해보자.<br />
1) 총알간의 충돌검사<br />
2) 총알과 비행기의 충돌검사<br />
3) 비행기간의 충돌검사<br />
<br />
그런데 비행기가 적기와 플레이어의 비행기로 2 종류가 있으니 총 5가지 항목에 대해서 검사를 해야한다.<br />
먼저 매 tick 마다 총알간 충돌 검사를 하자.<br />
<pre class="brush: java; html-script: true">Set<Bullet> removeBulletSet = new HashSet<Bullet>();<br />
for (int i = 0; i < bullets.size() - 1; ++i) {<br />
    for (int j = i + 1; j < bullets.size(); ++j) {<br />
        Bullet lhs = bullets.get(i), rhs = bullets.get(j);<br />
        if (Math.abs(lhs.pos.x - rhs.pos.x) < 8 && Math.abs(lhs.pos.y - rhs.pos.y) < 20) {<br />
            removeBulletSet.add(lhs);<br />
            removeBulletSet.add(rhs);<br />
        }<br />
    }<br />
}<br />
for (Bullet removal: removeBulletSet) <br />
    bullets.remove(removal);</pre><br />
너무 치밀하게 충돌 검사를 하면 탄막놀이가 힘들어지니까 후하게 x 범위 4, y 범위 10으로 주자-_-<br />
<br />
대충하는 건 좋은데 문제가 생겼다.<br />
space 키를 누르고 있으면 그 총알들이 겹쳐서 다 충돌처리가 되어버린다.<br />
이 문제를 없애기 위해 shot delay 를 준다.<br />
<pre class="brush: java; html-script: true">private long shotTick = 0;<br />
private void playerShot() {<br />
    if (shotTick < System.currentTimeMillis()) {<br />
        shotTick = System.currentTimeMillis() + 200;<br />
        bullets.add(new Bullet(shipPos.x, shipPos.y, -1));<br />
    }<br />
}</pre><br />
<br />
그리고 나머지 충돌 처리도 한다.<br />
적기와 플레이어의 비행기는 영역을 갖는 Rectangle 이므로 Rectangle 의 intersect 함수를 쓰면 간단하다.<br />
<pre class="brush: java; html-script: true">private void checkCollision() {<br />
    Set<Bullet> removeBulletSet = new HashSet<Bullet>();<br />
    Set<EnemyPos> removeEnemySet = new HashSet<EnemyPos>();<br />
    int shipWidth = ship.getWidth(this), shipHeight = ship.getHeight(this);<br />
    int enemyWidth = enemy.getWidth(this), enemyHeight = enemy.getHeight(this);<br />
    for (int i = 0; i < bullets.size() - 1; ++i) {<br />
        for (int j = i + 1; j < bullets.size(); ++j) {<br />
            Bullet lhs = bullets.get(i), rhs = bullets.get(j);<br />
            if (Math.abs(lhs.pos.x - rhs.pos.x) < 8 && Math.abs(lhs.pos.y - rhs.pos.y) < 20) {<br />
                removeBulletSet.add(lhs);<br />
                removeBulletSet.add(rhs);<br />
            }<br />
        }<br />
    }<br />
    Rectangle2D shipRect = new Rectangle2D.Double(shipPos.x - shipWidth / 2, <br />
            shipPos.y - shipHeight / 2, shipWidth, shipHeight);<br />
    for (Bullet bullet: bullets) {<br />
        for (EnemyPos enemyPos: enemies) {<br />
            if (Math.abs(enemyPos.current.getX() - bullet.pos.x) < enemyWidth <br />
                    && Math.abs(enemyPos.current.getY() - bullet.pos.y) < enemyHeight) {<br />
                removeEnemySet.add(enemyPos);<br />
                removeBulletSet.add(bullet);<br />
            }<br />
        }<br />
        if (Math.abs(shipPos.x - bullet.pos.x) < shipWidth<br />
                && Math.abs(shipPos.y - bullet.pos.y) < shipHeight) {<br />
            removeBulletSet.add(bullet);<br />
        }<br />
    }<br />
    for (int i = 0; i < enemies.size() - 1; ++i) {<br />
        EnemyPos lhs = enemies.get(i);<br />
        Rectangle2D lhsRect = new Rectangle2D.Double(lhs.current.getX() - enemyWidth / 2, <br />
                lhs.current.getY() - enemyHeight / 2, enemyWidth, enemyHeight);<br />
        for (int j = i + 1; j < enemies.size(); ++j) {<br />
            EnemyPos rhs = enemies.get(j);<br />
            Rectangle2D rhsRect = new Rectangle2D.Double(rhs.current.getX() - enemyWidth / 2, <br />
                    rhs.current.getY() - enemyHeight / 2, enemyWidth, enemyHeight);<br />
            if (lhsRect.intersects(rhsRect)) {<br />
                removeEnemySet.add(lhs);<br />
                removeEnemySet.add(rhs);<br />
            }<br />
        }<br />
        if (lhsRect.intersects(shipRect)) {<br />
            removeEnemySet.add(lhs);<br />
        }<br />
    }<br />
    for (Bullet removal: removeBulletSet) <br />
        bullets.remove(removal);<br />
    for (EnemyPos removal: removeEnemySet)<br />
        enemies.remove(removal);<br />
}</pre><br />
<br />
엄청나게 대충 작성한 결과로 적기가 자신이 쏜 총알에 맞아 사망하는 놀라운 일이 발생했다-_-;<br />
여기까지 코드 전문은 다음과 같다.<br />
<pre class="brush: java; html-script: true">import java.util.*;<br />
import java.awt.*;<br />
import java.awt.event.*;<br />
import java.awt.geom.*;<br />
import javax.swing.*;<br />
public class Tatieul extends JPanel implements KeyListener, ActionListener {<br />
    private Point shipPos = new Point(320, 400);<br />
    private Image ship, enemy;<br />
    private ArrayList<Bullet> bullets = new ArrayList<Bullet>();<br />
    private ArrayList<EnemyPos> enemies = new ArrayList<EnemyPos>();<br />
    private long spawnTick = 0;<br />
    private long shotTick = 0;<br />
    public Tatieul() {<br />
        setPreferredSize(new Dimension(640, 480));<br />
        setFocusable(true);<br />
        addKeyListener(this);<br />
        ship = Toolkit.getDefaultToolkit().getImage("player.png");<br />
        enemy = Toolkit.getDefaultToolkit().getImage("enemy.png");<br />
        new javax.swing.Timer(100, this).start();<br />
    }<br />
    public void keyPressed(KeyEvent e) {<br />
        switch (e.getKeyCode()) {<br />
        case KeyEvent.VK_UP:    shipPos.y -= 10; break;<br />
        case KeyEvent.VK_DOWN:  shipPos.y += 10; break;<br />
        case KeyEvent.VK_LEFT:  shipPos.x -= 10; break;<br />
        case KeyEvent.VK_RIGHT: shipPos.x += 10; break;<br />
        case KeyEvent.VK_SPACE: playerShot(); break;<br />
        }<br />
        repaint();<br />
    }<br />
    private void playerShot() {<br />
        if (shotTick < System.currentTimeMillis()) {<br />
            shotTick = System.currentTimeMillis() + 200;<br />
            bullets.add(new Bullet(shipPos.x, shipPos.y - (ship.getHeight(this) / 2 + 8), -1));<br />
        }<br />
    }<br />
    public void actionPerformed(ActionEvent e) {<br />
        updateEnemyPos();<br />
        updateBullets();<br />
        checkCollision();<br />
        generateEnemy();<br />
        generateEnemyBullet();<br />
        repaint();<br />
    }<br />
    private void checkCollision() {<br />
        Set<Bullet> removeBulletSet = new HashSet<Bullet>();<br />
        Set<EnemyPos> removeEnemySet = new HashSet<EnemyPos>();<br />
        int shipWidth = ship.getWidth(this), shipHeight = ship.getHeight(this);<br />
        int enemyWidth = enemy.getWidth(this), enemyHeight = enemy.getHeight(this);<br />
        for (int i = 0; i < bullets.size() - 1; ++i) {<br />
            for (int j = i + 1; j < bullets.size(); ++j) {<br />
                Bullet lhs = bullets.get(i), rhs = bullets.get(j);<br />
                if (Math.abs(lhs.pos.x - rhs.pos.x) < 8 && Math.abs(lhs.pos.y - rhs.pos.y) < 20) {<br />
                    removeBulletSet.add(lhs);<br />
                    removeBulletSet.add(rhs);<br />
                }<br />
            }<br />
        }<br />
        Rectangle2D shipRect = new Rectangle2D.Double(shipPos.x - shipWidth / 2, <br />
                shipPos.y - shipHeight / 2, shipWidth, shipHeight);<br />
        for (Bullet bullet: bullets) {<br />
            for (EnemyPos enemyPos: enemies) {<br />
                if (Math.abs(enemyPos.current.getX() - bullet.pos.x) < enemyWidth <br />
                        && Math.abs(enemyPos.current.getY() - bullet.pos.y) < enemyHeight) {<br />
                    removeEnemySet.add(enemyPos);<br />
                    removeBulletSet.add(bullet);<br />
                }<br />
            }<br />
            if (Math.abs(shipPos.x - bullet.pos.x) < shipWidth<br />
                    && Math.abs(shipPos.y - bullet.pos.y) < shipHeight) {<br />
                removeBulletSet.add(bullet);<br />
            }<br />
        }<br />
        for (int i = 0; i < enemies.size() - 1; ++i) {<br />
            EnemyPos lhs = enemies.get(i);<br />
            Rectangle2D lhsRect = new Rectangle2D.Double(lhs.current.getX() - enemyWidth / 2, <br />
                    lhs.current.getY() - enemyHeight / 2, enemyWidth, enemyHeight);<br />
            for (int j = i + 1; j < enemies.size(); ++j) {<br />
                EnemyPos rhs = enemies.get(j);<br />
                Rectangle2D rhsRect = new Rectangle2D.Double(rhs.current.getX() - enemyWidth / 2, <br />
                        rhs.current.getY() - enemyHeight / 2, enemyWidth, enemyHeight);<br />
                if (lhsRect.intersects(rhsRect)) {<br />
                    removeEnemySet.add(lhs);<br />
                    removeEnemySet.add(rhs);<br />
                }<br />
            }<br />
            if (lhsRect.intersects(shipRect)) {<br />
                removeEnemySet.add(lhs);<br />
            }<br />
        }<br />
        for (Bullet removal: removeBulletSet) <br />
            bullets.remove(removal);<br />
        for (EnemyPos removal: removeEnemySet)<br />
            enemies.remove(removal);<br />
    }<br />
    private void updateEnemyPos() {<br />
        Iterator<EnemyPos> iterator = enemies.iterator();<br />
        while (iterator.hasNext()) {<br />
            EnemyPos pos = iterator.next();<br />
            pos.current.setLocation(pos.current.getX() + pos.delta.getX(), <br />
                    pos.current.getY() + pos.delta.getY());<br />
            if (pos.current.getY() > 560)<br />
                iterator.remove();<br />
        }<br />
    }<br />
    private void updateBullets() {<br />
        Iterator<Bullet> iterator = bullets.iterator();<br />
        while (iterator.hasNext()) {<br />
            Bullet bullet = iterator.next();<br />
            bullet.pos.y += bullet.direction * 20;<br />
            if ((bullet.direction < 0 && bullet.pos.y < 0)<br />
                    || (bullet.direction > 0 && bullet.pos.y > 560))<br />
                iterator.remove();<br />
        }<br />
    }<br />
    private void generateEnemy() {<br />
        if (spawnTick < System.currentTimeMillis()) {<br />
            spawnTick = System.currentTimeMillis() + new Random().nextInt(2000) + 500;<br />
            enemies.add(new EnemyPos(enemy.getHeight(this)));<br />
        }<br />
    }<br />
    private void generateEnemyBullet() {<br />
        for (EnemyPos enemyPos: enemies) {<br />
            if (Math.random() < 0.2) {<br />
                bullets.add(new Bullet((int) enemyPos.current.getX(), <br />
                        (int) enemyPos.current.getY() + (enemy.getHeight(this) / 2 + 8), 1));<br />
            }<br />
        }<br />
    }<br />
    public void keyReleased(KeyEvent e) {}<br />
    public void keyTyped(KeyEvent e) {}<br />
    public void paintComponent(Graphics g) {<br />
        g.setColor(Color.white);<br />
        g.fillRect(0, 0, 640, 480);<br />
        g.drawImage(ship, shipPos.x - ship.getWidth(this) / 2, shipPos.y - ship.getHeight(this) / 2, this);<br />
        for (EnemyPos enemyPos: enemies) {<br />
            g.drawImage(enemy, (int) enemyPos.current.getX() - enemy.getWidth(this) / 2, <br />
                    (int) enemyPos.current.getY() - enemy.getHeight(this) / 2, this);<br />
        }<br />
        g.setColor(Color.black);<br />
        for (Bullet bullet: bullets)<br />
            g.drawLine(bullet.pos.x, bullet.pos.y, bullet.pos.x, bullet.pos.y - 4);<br />
    }<br />
    public static void main(String[] args) {<br />
        JFrame frame = new JFrame("Tatieul - New Generation Shooting Game");<br />
        frame.setContentPane(new Tatieul());<br />
        frame.pack();<br />
        frame.setLocationRelativeTo(null);<br />
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);<br />
        frame.setVisible(true);<br />
    }<br />
}<br />
class EnemyPos {<br />
    Point2D delta, current;<br />
    public EnemyPos(int shipHeight) {<br />
        Random rand = new Random();<br />
        float lifetime = rand.nextFloat() * 50 + 50;<br />
        int startX = rand.nextInt(640);<br />
        int endX = rand.nextInt(640);<br />
        delta = new Point2D.Float((endX - startX) / lifetime, (480 + shipHeight * 2) / lifetime);<br />
        current = new Point2D.Float(startX, -1 * shipHeight);<br />
    }<br />
}<br />
class Bullet {<br />
    Point pos;<br />
    int direction;<br />
    public Bullet(int x, int y, int direction) {<br />
        this.pos = new Point(x, y);<br />
        this.direction = direction;<br />
    }<br />
}</pre><br />
<br />
#<br />
억지로 한 파일에 최대한 짧고 대충 짜려다보니 코드가 개판이 되었다.<br />
여러 이슈가 있겠지만, 일단 다음번에는 저걸 보다 구조화하는 작업을 해보도록 하자.<br />
(안 그러면 코드가 너무 더러워서 도저히 진행을 못할 것 같다-_-)<br />

				</div>
                <hr>

                <!-- the comments -->
				<div id="disqus_thread"></div>
				<script type="text/javascript">
					/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
					var disqus_shortname = 'lacti'; // required: replace example with your forum shortname

					/* * * DON'T EDIT BELOW THIS LINE * * */
					(function() {
						var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
						dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
						(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
					})();
				</script>
				<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
				<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

            </div>

            <div class="col-lg-4">

                <div class="well">
					<h4>Related</h4>
					<ul>
						<li><a href="/a/자바로_만드는_비행기_게임__1.html">자바로 만드는 비행기 게임 #1</a> <span class="date">9. 21.</span></li>
						<li><a href="/a/자바로_만드는_비행기_게임__2.html">자바로 만드는 비행기 게임 #2</a> <span class="date">9. 22.</span></li>
						<li><a href="/a/자바로_만드는_비행기_게임__4.html">자바로 만드는 비행기 게임 #4</a> <span class="date">11. 13.</span></li>
					</ul>
                </div>
                <!-- /well -->
                <div class="well">
					<h4>Recents <a href="/" class="show-all">(all)</a></h4>
					<ul>

						<li><a href="/a/패킷_enum에_따른_packet_콜백_함수_자동생성.html">패킷 enum에 따른 packet 콜백 함수 자동생성</a> <span class="date">11. 19.</span></li>
						<li><a href="/a/비동기_프로그래밍_패턴__2.html">비동기 프로그래밍 패턴 #2</a> <span class="date">11. 19.</span></li>
						<li><a href="/a/비동기_프로그래밍_패턴.html">비동기 프로그래밍 패턴</a> <span class="date">10. 9.</span></li>
						<li><a href="/a/websocket,_webRTC.html">websocket, webRTC</a> <span class="date">9. 7.</span></li>
						<li><a href="/a/여의도_스터디_정리__4.html">여의도 스터디 정리 #4</a> <span class="date">8. 26.</span></li>
						<li><a href="/a/여의도_스터디_정리__3.html">여의도 스터디 정리 #3</a> <span class="date">8. 18.</span></li>
						<li><a href="/a/여의도_스터디_과제_풀이__2.html">여의도 스터디 과제 풀이 #2</a> <span class="date">8. 12.</span></li>
					</ul>
                </div>
                <!-- /well -->
				<gcse:search></gcse:search>
            </div>
        </div>

        <hr>

        <footer>
            <div class="row">
                <div class="col-lg-12">
                    <p>Copyright &copy; lacti 2014</p>
                </div>
            </div>
        </footer>

    </div>
    <!-- /.container -->

    <!-- JavaScript -->
    <script src="../js/jquery-1.10.2.js"></script>
    <script src="../js/bootstrap.js"></script>

	<script type='text/javascript'>
		SyntaxHighlighter.all();
	</script>

	<script>
	  (function() {
		var cx = '001870890642618183212:k8iqprsstre';
		var gcse = document.createElement('script');
		gcse.type = 'text/javascript';
		gcse.async = true;
		gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
			'//www.google.com/cse/cse.js?cx=' + cx;
		var s = document.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(gcse, s);
	  })();
	</script>
</body>

</html>
